HW3
================
Zhenkun Fang
2024-10-16

# Problem 1

This dataset consists of 2595176 rows and 7 columns. The variables
include the weather station ID, observation date, precipitation
(measured in tenths of millimeters), snowfall (in millimeters), snow
depth (in millimeters), and both minimum and maximum temperatures (in
tenths of degrees Celsius).

``` r
ny_noaa %>% 
  count(tmax) %>%
  arrange(desc(n))
```

    ## # A tibble: 533 × 2
    ##    tmax        n
    ##    <chr>   <int>
    ##  1 <NA>  1134358
    ##  2 256     30736
    ##  3 267     30692
    ##  4 244     28909
    ##  5 239     28628
    ##  6 233     27902
    ##  7 250     27392
    ##  8 228     27342
    ##  9 261     26654
    ## 10 278     26355
    ## # ℹ 523 more rows

``` r
ny_noaa %>% 
  count(tmin) %>%
  arrange(desc(n))
```

    ## # A tibble: 549 × 2
    ##    tmin        n
    ##    <chr>   <int>
    ##  1 <NA>  1134420
    ##  2 0       32431
    ##  3 -11     31385
    ##  4 6       30763
    ##  5 -22     30502
    ##  6 -17     30163
    ##  7 -6      28909
    ##  8 17      28771
    ##  9 100     27891
    ## 10 128     27391
    ## # ℹ 539 more rows

For vairbles `tmax` and `tmin`, nearly half of the observations are
`NA`, indicating that there is a serious issue of missing data.

``` r
ny_noaa %>% 
  count(snow) %>%
  arrange(desc(n))
```

    ## # A tibble: 282 × 2
    ##     snow       n
    ##    <int>   <int>
    ##  1     0 2008508
    ##  2    NA  381221
    ##  3    25   31022
    ##  4    13   23095
    ##  5    51   18274
    ##  6    76   10173
    ##  7     8    9962
    ##  8     5    9748
    ##  9    38    9197
    ## 10     3    8790
    ## # ℹ 272 more rows

``` r
ny_noaa = 
  ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>% 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin))
```

For the variable `snow`, the most frequently observed value is 0,
reflecting that snowfall does not occur on most days in NY. The second
most common value is `NA`, indicating missing data.

``` r
ny_noaa %>% 
  group_by(id, year, month) %>% 
  filter(month %in% c(1, 7)) %>% 
  summarize(mean_tmax = mean(tmax, na.rm = TRUE, color = id)) %>% 
  ggplot(aes(x = year, y = mean_tmax, group = id)) + geom_point() + geom_path() +
  facet_grid(~month) +
  labs(title = "Mean monthly temperature for each station across years for January and July",
       x = "Year",
       y = "Average max temperature")
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

<img src="p8105_hw3_zf2352_files/figure-gfm/two-panel plot-1.png" width="90%" />

The two-panel plot below displays the average maximum temperature in
January and July across stations over the years. As expected, the mean
temperature in January is significantly lower than in July for all
stations and years. The stations generally follow similar temperature
patterns, with peaks and valleys within each month across the years—when
one station has a high monthly mean temperature for a given year, most
other stations exhibit a similar trend. However, there is one notably
cold station in July of 1987 or 1988, along with a few other less
extreme outliers.

``` r
hex = 
  ny_noaa %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex()

ridge = 
  ny_noaa %>% 
  filter(snow < 100, snow > 0) %>% 
  ggplot(aes(x = tmax, y = as.factor(year))) + 
  geom_density_ridges(scale = .90)
  
hex+ridge
```

    ## Picking joint bandwidth of 8.06

<img src="p8105_hw3_zf2352_files/figure-gfm/another two-panel plot-1.png" width="90%" />

# Problem 2

``` r
demodata = 
  read_csv("/Users/rubp/Desktop/Data Sci 1/Week7/p8105_hw3_zf2352/nhanes_covar.csv",
            na = c("NA", ".", "")) %>% 
  janitor::clean_names() 
```

    ## New names:
    ## Rows: 254 Columns: 5
    ## ── Column specification
    ## ──────────────────────────────────────────────────────── Delimiter: "," chr
    ## (5): ...1, 1 = male, ...3, ...4, 1 = Less than high school
    ## ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
    ## Specify the column types or set `show_col_types = FALSE` to quiet this message.
    ## • `` -> `...1`
    ## • `` -> `...3`
    ## • `` -> `...4`

``` r
accel = 
  read_csv("/Users/rubp/Desktop/Data Sci 1/Week7/p8105_hw3_zf2352/nhanes_accel.csv",
            na = c("NA", ".", "")) %>% 
  janitor::clean_names()
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
demodata = 
  demodata[-c(1 ,2 ,3 , 4), ]

colnames(demodata) [1] = "seqn"
colnames(demodata) [2] = "sex"
colnames(demodata) [3] = "age"
colnames(demodata) [4] = "bmi"
colnames(demodata) [5] = "education"

demodata = demodata %>% 
  mutate(seqn = as.numeric(seqn))

accel = accel %>% 
  mutate(seqn = as.numeric(seqn))

mims = demodata %>% 
  left_join(accel, by = "seqn") %>% 
  drop_na(bmi, education) %>% 
  filter(age >= 21) %>% 
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
    education = factor(education, levels = c(1, 2, 3), 
                       labels = c("Less than high school",
                              "High school equivalent",
                              "More than high school")),
    age = as.numeric(age),
    bmi = as.numeric(bmi)
  )
```

``` r
mims_table = mims %>% 
  count(sex, education) %>% 
  spread(sex, n) %>% 
  knitr::kable()

mims_table
```

| education              | Male | Female |
|:-----------------------|-----:|-------:|
| Less than high school  |   27 |     28 |
| High school equivalent |   35 |     23 |
| More than high school  |   56 |     59 |

``` r
mims_ridge = mims %>% 
  ggplot(aes(x = age, y = as.factor(education))) + 
  facet_grid(~sex) +
  geom_density_ridges(scale = .90) +
  labs(
    title = "Age distributions for men and women in each education category",
    x = "Age (years)",
    y = "Education"
  )

mims_ridge
```

    ## Picking joint bandwidth of 8.11

    ## Picking joint bandwidth of 7.95

<img src="p8105_hw3_zf2352_files/figure-gfm/create visualization-1.png" width="90%" />

The distribution across education levels shows that there is a fairly
balanced gender representation in the “Less than high school” and “More
than high school” categories. However, for the “High school equivalent”
category, there is a notable gender disparity, with more males than
females.

The gender distribution within each education category is relatively
balanced, though there are slight variations, particularly in the “High
school equivalent” category where males outnumber females around the age
of 30. For both sexes, participants with “Less than high school”
education tend to be older, particularly concentrated in the 60-80 age
range, which might suggest that older individuals in this dataset tend
to have less formal education.

``` r
mims_total = mims %>% 
  rowwise() %>% 
  mutate(total_activity = sum(c_across(starts_with("min")), na.rm = TRUE)) %>% 
  relocate(last_col(), .before = 6)
```

``` r
mims_total %>% 
  ggplot(aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = .5) +
  geom_smooth(se = FALSE) + 
  facet_grid(. ~ education) +
  labs(
    x = "Age (years)",
    y = "Total accelerometer activity",
    title = "Total accelerometer activity of men and women with different education"
  )
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

<img src="p8105_hw3_zf2352_files/figure-gfm/visualization-1.png" width="90%" />

Across all education categories, there is a noticeable decrease in total
accelerometer activity as age increases, particularly after age 60. This
trend is consistent with expectations that physical activity generally
decreases as people age.

- Less than high school: Men tend to have a slight edge in activity
  levels compared to women, particularly in younger age groups, though
  both genders show a steep decline in activity after age 60. The smooth
  trend for women appears to dip more significantly at older ages.

- High school equivalent: In this group, women’s activity levels seem to
  peak around middle age (40–50 years) and remain higher than men’s for
  a significant portion of the age range. However, the activity levels
  for both men and women drop sharply after age 60.

- More than high school: In the more educated group, men and women have
  more comparable activity levels, with some fluctuations around age
  40–60. Women’s activity seems to remain relatively higher at older
  ages in this category.

``` r
mims_total_long = mims_total %>% 
  pivot_longer(cols = starts_with("min"), 
               names_to = "minute", 
               values_to = "activity") %>% 
  mutate(minute = as.numeric(gsub("min", "", minute))) %>% 
  group_by(education, sex, minute) %>% 
  summarise(avg_activity = mean(activity, na.rm = TRUE))
```

    ## `summarise()` has grouped output by 'education', 'sex'. You can override using
    ## the `.groups` argument.

``` r
mims_total_long %>% 
  ggplot(aes(x = minute, y = avg_activity, color = sex)) +
  geom_line(alpha = .5) +  
  geom_smooth(method = "loess", se = FALSE) +
  facet_wrap(~ education) +
  labs(
    x = "Minute in 24 hours",
    y = "Average activity",
    title = "24-hour activity time courses for each education level"
  )
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_zf2352_files/figure-gfm/plot-24 hour-1.png" width="90%" />

Across all education levels, the activity levels follow a similar daily
pattern, with a sharp increase in activity after the start of the day
(around minute 500, corresponding to roughly 8 AM), peaking around
midday, and then gradually declining into the evening.

In general, women appear to have slightly higher activity levels
throughout the day compared to men across all education levels,
especially during the peak activity hours around midday. The smooth
trends for women (in teal) often show a more sustained or higher peak of
activity than men (in red), particularly in the “High school equivalent”
and “More than high school” groups.

Participants with more education tend to have higher activity levels
overall, especially during the peak hours of the day. In the “more than
high school” group, the curves for both men and women show a higher
midday peak, which could suggest a more active and structured lifestyle.
Women in this group show a particularly strong midday peak, indicating
higher physical engagement during daytime hours.

# Probelm 3

``` r
jan_2020 = 
  read_csv("/Users/rubp/Desktop/Data Sci 1/Week7/p8105_hw3_zf2352/citibike/Jan 2020 Citi.csv", na = c("NA", ".", "")) %>% 
  janitor::clean_names() 
```

    ## Rows: 12420 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
jan_2024 = 
  read_csv("/Users/rubp/Desktop/Data Sci 1/Week7/p8105_hw3_zf2352/citibike/Jan 2024 Citi.csv",
            na = c("NA", ".", "")) %>% 
  janitor::clean_names()
```

    ## Rows: 18861 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
jul_2020 = 
  read_csv("/Users/rubp/Desktop/Data Sci 1/Week7/p8105_hw3_zf2352/citibike/July 2020 Citi.csv",
            na = c("NA", ".", "")) %>% 
  janitor::clean_names()
```

    ## Rows: 21048 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
jul_2024 = 
  read_csv("/Users/rubp/Desktop/Data Sci 1/Week7/p8105_hw3_zf2352/citibike/July 2024 Citi.csv",
            na = c("NA", ".", "")) %>% 
  janitor::clean_names()
```

    ## Rows: 47156 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (6): ride_id, rideable_type, weekdays, start_station_name, end_station_n...
    ## dbl (1): duration
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
citi_bike = bind_rows(
  jan_2020 |>
    mutate(month = "January", year = 2020),
  jul_2020 |>
    mutate(month = "July", year = 2020),
  jan_2024 |>
    mutate(month = "January", year = 2024),
  jul_2024 |>
    mutate(month = "July", year = 2024)
) |>
  relocate(year, month) |>
  drop_na(start_station_name, end_station_name, member_casual)
```

The dataset have 9 columns and more than 99253 observations:

- year: year of data collection time.

- month: month of data collection time.

- ride_id: Unique identifier for each ride.

- rideable_type: Type of bike (e.g., classic bike).

- weekdays: Day of the week the ride occurred.

- duration: Duration of the ride in minutes.

- start_station_name: Station where the ride started.

- end_station_name: Station where the ride ended.

- member_casual: Type of user (member or casual).

``` r
citi_bike %>% 
  group_by(year, month, member_casual) %>% 
  summarize(total_rides = n()) %>% 
  spread(member_casual, total_rides, fill = 0) %>% 
  knitr::kable()
```

    ## `summarise()` has grouped output by 'year', 'month'. You can override using the
    ## `.groups` argument.

| year | month   | casual | member |
|-----:|:--------|-------:|-------:|
| 2020 | January |    980 |  11418 |
| 2020 | July    |   5625 |  15388 |
| 2024 | January |   2094 |  16705 |
| 2024 | July    |  10843 |  36200 |

Both casual and member ridership increased from 2020 to 2024, suggesting
a growth in the Citi Bike system’s overall usage.

The seasonal variation is clear, with July showing higher ridership
compared to January in both years, likely due to weather conditions.

``` r
jul_2024 %>% 
  group_by(start_station_name) %>%
  summarise(ride_count = n()) %>%
  arrange(desc(ride_count)) %>%
  head(5) %>% 
  knitr::kable()
```

| start_station_name       | ride_count |
|:-------------------------|-----------:|
| Pier 61 at Chelsea Piers |        163 |
| University Pl & E 14 St  |        155 |
| W 21 St & 6 Ave          |        152 |
| West St & Chambers St    |        150 |
| W 31 St & 7 Ave          |        146 |

``` r
median_duration_data = citi_bike %>%
  group_by(weekdays, month, year) %>%
  summarise(median_duration = median(duration, na.rm = TRUE))
```

    ## `summarise()` has grouped output by 'weekdays', 'month'. You can override using
    ## the `.groups` argument.

``` r
median_duration_data$weekdays <- factor(median_duration_data$weekdays, 
                                        levels = c("Monday", "Tuesday", 
                                                   "Wednesday", "Thursday", 
                                                   "Friday", "Saturday",
                                                   "Sunday"))
```

``` r
median_duration_data %>% 
  ggplot(aes(x = weekdays, y = median_duration, fill = month)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ year, scales = "free") +  
  labs(title = "Median Ride Duration by Weekdays, Month, and Year",
       x = "Day of the Week",
       y = "Median Ride Duration (minutes)",
       fill = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

<img src="p8105_hw3_zf2352_files/figure-gfm/plot-1.png" width="90%" />

Across both 2020 and 2024, the median ride duration in July is
consistently higher than in January for all days of the week. This is
likely due to the more favorable weather conditions in July, which
encourages longer rides.

In both years, the median ride duration appears to be higher on weekends
(Saturday and Sunday) compared to weekdays, suggesting that people may
engage in longer rides for recreational purposes on weekends.

In 2024, the overall median ride durations for both January and July are
slightly lower compared to 2020. This could indicate that rides have
become shorter on average, possibly due to changes in user behavior,
bike availability, or other external factors.

``` r
data_2024 = citi_bike %>% 
  filter(year == 2024)

ggplot(data_2024, aes(x = member_casual, y = duration, fill = rideable_type)) +
  geom_violin(scale = "width", adjust = 1.5, trim = FALSE) +
  facet_wrap(~ month) +
  labs(title = "Impact of Month, Membership Status, and Bike Type on Ride Duration (2024)",
       x = "Membership Status",
       y = "Ride Duration (minutes)",
       fill = "Bike Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

<img src="p8105_hw3_zf2352_files/figure-gfm/unnamed-chunk-6-1.png" width="90%" />

Electric bikes (in blue) generally show shorter ride durations compared
to classic bikes (in red) across all groups, particularly among members.
This suggests that electric bikes are predominantly used for shorter
trips, likely due to their higher speed and convenience for quick
commutes.

Casual riders using classic bikes have a wider range of ride durations
compared to members, with some rides extending up to or beyond 200
minutes. This could indicate that casual riders use the bikes more for
leisure or tourism-related activities, whereas members typically take
shorter, more consistent trips, possibly for commuting or other routine
purposes.

In July, ride durations are slightly more variable than in January,
particularly for casual riders. The warmer weather in July might
encourage longer, more leisurely rides, especially for casual users.

Members consistently take shorter trips with less variation in ride
duration, regardless of the bike type or month.
